/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Injector } from '@angular/core';
import * as _ from 'lodash';
import { SemMediaService } from '../../sem-media.service';
export class SemMediaSettingsContainerComponent {
    /**
     * @param {?} _mediaService
     * @param {?} injector
     */
    constructor(_mediaService, injector) {
        // this.widget = this.injector.get('widget');
        // if(this.widget.componentName === 'SemMediaContainerComponent') {
        //   console.log('Got the wysiwyg data', this.widget);
        // }
        this._mediaService = _mediaService;
        this.injector = injector;
        this.widget = {
            componentName: '',
            data: `
    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer ook a galley of type
    and scrambled it to make a type specimen book. It has survived not only five ce nturies, but also the leap into electronic
    typesetting, remaining essentially unchanged. It was popu larised in the 1960s with the release of Letraset sheets
    containing`
        };
        this.userImages = [];
        this.editVisible = false;
        this.uploadPanelFlag = true;
        this.imageNameList = [];
        this.isTestAOpened = false;
        this._mediaService.imageComponentChanges.subscribe(allImages => {
            /** @type {?} */
            let editMode = false;
            this.imageNameList = [];
            this.userImages = allImages;
            for (const image of allImages) {
                editMode = editMode || image.editMode;
                this.imageNameList.push(image.fileName);
            }
            setTimeout(() => {
                this.editVisible = editMode;
            });
        });
        this._mediaService.imageConfigChanges.subscribe(config => {
            this.config = _.cloneDeep(config);
        });
        this._mediaService.imageLoadChanges.subscribe(allImages => {
            this.tempImages = allImages;
            this.imageNameList = [];
            this.userImages = allImages;
            for (const image of allImages) {
                this.imageNameList.push(image.fileName);
            }
            this.key = allImages.length - 1;
            this.editVisible = false;
            if (allImages.length > 1) {
                this.uploadPanelFlag = false;
            }
        });
        this._mediaService.tempChanges.subscribe(allImages => {
            this.tempImages = allImages;
        });
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @param {?} image
     * @return {?}
     */
    uploadedImage(image) {
        this._mediaService.putImage(image);
    }
    /**
     * @param {?} index
     * @return {?}
     */
    onEnableEditImage(index) {
        this._mediaService.onEditEnable(index);
        this.uploadPanelFlag = true;
        this.key = index;
    }
    /**
     * @param {?} index
     * @return {?}
     */
    onEditImage(index) {
        this.key = index;
        this._mediaService.onEditEnable(index);
    }
    /**
     * @param {?} index
     * @return {?}
     */
    onDeleteImage(index) {
        this._mediaService.onDeleteImage(index);
    }
    /**
     * @param {?} mode
     * @return {?}
     */
    onMenu(mode) {
        switch (mode) {
            case 'IMAGES':
                this.uploadPanelFlag = true;
                break;
            case 'DUPLICATE':
                break;
            case 'SETTINGS':
                break;
            case 'DELETE':
                this._mediaService.clearImages();
                this.imageNameList = [];
                this.uploadPanelFlag = true;
                break;
        }
    }
    /**
     * @param {?} formData
     * @return {?}
     */
    onChangedForm(formData) {
        this._mediaService.formChanged(this.key, formData);
    }
    /**
     * @param {?} mode
     * @return {?}
     */
    onChangedEditMode(mode) {
        if (mode === 'APPLY') {
            // this.editVisible = false;
            if (this.imageNameList.length > 1) {
                this.uploadPanelFlag = false;
            }
        }
        this._mediaService.onEditImage(this.key, mode);
        this._mediaService.clearConfig(this.key);
    }
    /**
     * @param {?} index
     * @param {?} croppedImage
     * @return {?}
     */
    onCroppedImage(index, croppedImage) {
        this._mediaService.putCroppedImage(index, croppedImage);
    }
    /**
     * @param {?} isOpened
     * @return {?}
     */
    openTestA(isOpened) {
        this.isTestAOpened = isOpened;
    }
    /**
     * @param {?} item
     * @return {?}
     */
    croppedImage(item) {
        console.log('not sure', item);
    }
}
SemMediaSettingsContainerComponent.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line:component-selector,
                selector: '[sem-media-settings-container]',
                template: ` <div *ngIf="uploadPanelFlag" class="dialog-container bg-default left" style="width:100%;">
  <div class="dialog-container--body">
    <sem-panel
      [editVisible]="editVisible"
      [key]="key"
      [imageNameList]="imageNameList"
      (cropped)="croppedImage($event)"
      (uploaded)="uploadedImage($event)"
      (changedForm)="onChangedForm($event)"
      (editImage)="onEditImage($event)"
      (deleteImage)="onDeleteImage($event)"
      (changedEditMode)="onChangedEditMode($event)"
      (showUploadEvent)="editVisible = false"
      [userImages]="userImages"
    ></sem-panel>
  </div>
</div>
<div *ngIf="!uploadPanelFlag"
     class="settings-container dialog-container bg-default mt4">
        <sem-settings
          (pressedImages)="onMenu('IMAGES')"
          (pressedDuplicate)="onMenu('DUPLICATE')"
          (pressedSettings)="onMenu('SETTINGS')"
          (pressedDelete)="onMenu('DELETE')"
        >
        </sem-settings>
</div>

`,
                styles: [`:host(){display:block;border:1px solid #8b0000}.img-cropper{height:100%}`]
            },] },
];
SemMediaSettingsContainerComponent.ctorParameters = () => [
    { type: SemMediaService },
    { type: Injector }
];
if (false) {
    /** @type {?} */
    SemMediaSettingsContainerComponent.prototype.widget;
    /** @type {?} */
    SemMediaSettingsContainerComponent.prototype.userImages;
    /** @type {?} */
    SemMediaSettingsContainerComponent.prototype.editVisible;
    /** @type {?} */
    SemMediaSettingsContainerComponent.prototype.key;
    /** @type {?} */
    SemMediaSettingsContainerComponent.prototype.uploadPanelFlag;
    /** @type {?} */
    SemMediaSettingsContainerComponent.prototype.imageNameList;
    /** @type {?} */
    SemMediaSettingsContainerComponent.prototype.config;
    /** @type {?} */
    SemMediaSettingsContainerComponent.prototype.tempImages;
    /** @type {?} */
    SemMediaSettingsContainerComponent.prototype.isTestAOpened;
    /**
     * @type {?}
     * @private
     */
    SemMediaSettingsContainerComponent.prototype._mediaService;
    /**
     * @type {?}
     * @private
     */
    SemMediaSettingsContainerComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VtLW1lZGlhLXNldHRpbmdzLWNvbnRhaW5lci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bmcm9udHIvc2VtLW1lZGlhLyIsInNvdXJjZXMiOlsibGliL2NvbnRhaW5lcnMvc2VtLW1lZGlhLXNldHRpbmdzLWNvbnRhaW5lci9zZW0tbWVkaWEtc2V0dGluZ3MtY29udGFpbmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUF3QyxRQUFRLEVBQXVCLE1BQU0sZUFBZSxDQUFDO0FBRS9HLE9BQU8sS0FBSyxDQUFDLE1BQU0sUUFBUSxDQUFDO0FBQzVCLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQW9DMUQsTUFBTTs7Ozs7SUFxQkosWUFBb0IsYUFBOEIsRUFBVSxRQUFrQjtRQUM1RSw2Q0FBNkM7UUFDN0MsbUVBQW1FO1FBQ25FLHNEQUFzRDtRQUN0RCxJQUFJO1FBSmMsa0JBQWEsR0FBYixhQUFhLENBQWlCO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQXBCdkUsV0FBTSxHQUFHO1lBQ2QsYUFBYSxFQUFFLEVBQUU7WUFDakIsSUFBSSxFQUFHOzs7O2VBSUk7U0FDWixDQUFDO1FBR0YsZUFBVSxHQUFnQixFQUFFLENBQUM7UUFDN0IsZ0JBQVcsR0FBWSxLQUFLLENBQUM7UUFFN0Isb0JBQWUsR0FBWSxJQUFJLENBQUM7UUFDaEMsa0JBQWEsR0FBa0IsRUFBRSxDQUFDO1FBR2xDLGtCQUFhLEdBQUcsS0FBSyxDQUFDO1FBU3BCLElBQUksQ0FBQyxhQUFhLENBQUMscUJBQXFCLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxFQUFFOztnQkFDekQsUUFBUSxHQUFHLEtBQUs7WUFDcEIsSUFBSSxDQUFDLGFBQWEsR0FBRyxFQUFFLENBQUM7WUFDeEIsSUFBSSxDQUFDLFVBQVUsR0FBRyxTQUFTLENBQUM7WUFDNUIsR0FBRyxDQUFDLENBQUMsTUFBTSxLQUFLLElBQUksU0FBUyxDQUFDLENBQUMsQ0FBQztnQkFDOUIsUUFBUSxHQUFHLFFBQVEsSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDO2dCQUN0QyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDMUMsQ0FBQztZQUNELFVBQVUsQ0FBQyxHQUFHLEVBQUU7Z0JBQ2QsSUFBSSxDQUFDLFdBQVcsR0FBRyxRQUFRLENBQUM7WUFDOUIsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxhQUFhLENBQUMsa0JBQWtCLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxFQUFFO1lBQ3ZELElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNwQyxDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxFQUFFO1lBQ3hELElBQUksQ0FBQyxVQUFVLEdBQUcsU0FBUyxDQUFDO1lBQzVCLElBQUksQ0FBQyxhQUFhLEdBQUcsRUFBRSxDQUFDO1lBQ3hCLElBQUksQ0FBQyxVQUFVLEdBQUcsU0FBUyxDQUFDO1lBQzVCLEdBQUcsQ0FBQyxDQUFDLE1BQU0sS0FBSyxJQUFJLFNBQVMsQ0FBQyxDQUFDLENBQUM7Z0JBQzlCLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUMxQyxDQUFDO1lBQ0QsSUFBSSxDQUFDLEdBQUcsR0FBRyxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztZQUNoQyxJQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQztZQUN6QixFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3pCLElBQUksQ0FBQyxlQUFlLEdBQUcsS0FBSyxDQUFDO1lBQy9CLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsRUFBRTtZQUNuRCxJQUFJLENBQUMsVUFBVSxHQUFHLFNBQVMsQ0FBQztRQUM5QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7Ozs7SUFDRCxRQUFRO0lBQ1IsQ0FBQzs7Ozs7SUFDRCxhQUFhLENBQUMsS0FBVztRQUN2QixJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNyQyxDQUFDOzs7OztJQUNELGlCQUFpQixDQUFDLEtBQUs7UUFDckIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDdkMsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUM7UUFDNUIsSUFBSSxDQUFDLEdBQUcsR0FBRyxLQUFLLENBQUM7SUFDbkIsQ0FBQzs7Ozs7SUFDRCxXQUFXLENBQUMsS0FBSztRQUNmLElBQUksQ0FBQyxHQUFHLEdBQUcsS0FBSyxDQUFDO1FBQ2pCLElBQUksQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3pDLENBQUM7Ozs7O0lBQ0QsYUFBYSxDQUFDLEtBQUs7UUFDakIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDMUMsQ0FBQzs7Ozs7SUFDRCxNQUFNLENBQUMsSUFBSTtRQUNULE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDYixLQUFLLFFBQVE7Z0JBQ1gsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUM7Z0JBQzVCLEtBQUssQ0FBQztZQUNSLEtBQUssV0FBVztnQkFDZCxLQUFLLENBQUM7WUFDUixLQUFLLFVBQVU7Z0JBQ2IsS0FBSyxDQUFDO1lBQ1IsS0FBSyxRQUFRO2dCQUNYLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxFQUFFLENBQUM7Z0JBQ2pDLElBQUksQ0FBQyxhQUFhLEdBQUcsRUFBRSxDQUFDO2dCQUN4QixJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQztnQkFDNUIsS0FBSyxDQUFDO1FBQ1YsQ0FBQztJQUNILENBQUM7Ozs7O0lBQ0QsYUFBYSxDQUFDLFFBQWE7UUFDekIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUNyRCxDQUFDOzs7OztJQUNELGlCQUFpQixDQUFDLElBQVk7UUFDNUIsRUFBRSxDQUFDLENBQUMsSUFBSSxLQUFLLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDckIsNEJBQTRCO1lBQzVCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2xDLElBQUksQ0FBQyxlQUFlLEdBQUcsS0FBSyxDQUFDO1lBQy9CLENBQUM7UUFDSCxDQUFDO1FBQ0QsSUFBSSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUMvQyxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDM0MsQ0FBQzs7Ozs7O0lBQ0QsY0FBYyxDQUFDLEtBQUssRUFBRSxZQUFZO1FBQ2hDLElBQUksQ0FBQyxhQUFhLENBQUMsZUFBZSxDQUFDLEtBQUssRUFBRSxZQUFZLENBQUMsQ0FBQztJQUMxRCxDQUFDOzs7OztJQUNELFNBQVMsQ0FBQyxRQUFpQjtRQUN6QixJQUFJLENBQUMsYUFBYSxHQUFHLFFBQVEsQ0FBQztJQUNoQyxDQUFDOzs7OztJQUlELFlBQVksQ0FBQyxJQUFJO1FBQ2YsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUE7SUFDL0IsQ0FBQzs7O1lBdEpGLFNBQVMsU0FBQzs7Z0JBRVQsUUFBUSxFQUFFLGdDQUFnQztnQkFDMUMsUUFBUSxFQUFFOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0NBNEJYO2dCQUNDLE1BQU0sRUFBRSxDQUFDLDBFQUEwRSxDQUFDO2FBQ3JGOzs7WUFuQ1EsZUFBZTtZQUhrQyxRQUFROzs7O0lBd0NoRSxvREFPRTs7SUFHRix3REFBNkI7O0lBQzdCLHlEQUE2Qjs7SUFDN0IsaURBQVk7O0lBQ1osNkRBQWdDOztJQUNoQywyREFBa0M7O0lBQ2xDLG9EQUFZOztJQUNaLHdEQUF1Qjs7SUFDdkIsMkRBQXNCOzs7OztJQUdWLDJEQUFzQzs7Ozs7SUFBRSxzREFBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgIE91dHB1dCwgSW5qZWN0b3IsIFZpZXdDaGlsZCwgT25DaGFuZ2VzfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgU2VtTWVkaWFTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VtLW1lZGlhLnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOmNvbXBvbmVudC1zZWxlY3RvcixcbiAgc2VsZWN0b3I6ICdbc2VtLW1lZGlhLXNldHRpbmdzLWNvbnRhaW5lcl0nLFxuICB0ZW1wbGF0ZTogYCA8ZGl2ICpuZ0lmPVwidXBsb2FkUGFuZWxGbGFnXCIgY2xhc3M9XCJkaWFsb2ctY29udGFpbmVyIGJnLWRlZmF1bHQgbGVmdFwiIHN0eWxlPVwid2lkdGg6MTAwJTtcIj5cbiAgPGRpdiBjbGFzcz1cImRpYWxvZy1jb250YWluZXItLWJvZHlcIj5cbiAgICA8c2VtLXBhbmVsXG4gICAgICBbZWRpdFZpc2libGVdPVwiZWRpdFZpc2libGVcIlxuICAgICAgW2tleV09XCJrZXlcIlxuICAgICAgW2ltYWdlTmFtZUxpc3RdPVwiaW1hZ2VOYW1lTGlzdFwiXG4gICAgICAoY3JvcHBlZCk9XCJjcm9wcGVkSW1hZ2UoJGV2ZW50KVwiXG4gICAgICAodXBsb2FkZWQpPVwidXBsb2FkZWRJbWFnZSgkZXZlbnQpXCJcbiAgICAgIChjaGFuZ2VkRm9ybSk9XCJvbkNoYW5nZWRGb3JtKCRldmVudClcIlxuICAgICAgKGVkaXRJbWFnZSk9XCJvbkVkaXRJbWFnZSgkZXZlbnQpXCJcbiAgICAgIChkZWxldGVJbWFnZSk9XCJvbkRlbGV0ZUltYWdlKCRldmVudClcIlxuICAgICAgKGNoYW5nZWRFZGl0TW9kZSk9XCJvbkNoYW5nZWRFZGl0TW9kZSgkZXZlbnQpXCJcbiAgICAgIChzaG93VXBsb2FkRXZlbnQpPVwiZWRpdFZpc2libGUgPSBmYWxzZVwiXG4gICAgICBbdXNlckltYWdlc109XCJ1c2VySW1hZ2VzXCJcbiAgICA+PC9zZW0tcGFuZWw+XG4gIDwvZGl2PlxuPC9kaXY+XG48ZGl2ICpuZ0lmPVwiIXVwbG9hZFBhbmVsRmxhZ1wiXG4gICAgIGNsYXNzPVwic2V0dGluZ3MtY29udGFpbmVyIGRpYWxvZy1jb250YWluZXIgYmctZGVmYXVsdCBtdDRcIj5cbiAgICAgICAgPHNlbS1zZXR0aW5nc1xuICAgICAgICAgIChwcmVzc2VkSW1hZ2VzKT1cIm9uTWVudSgnSU1BR0VTJylcIlxuICAgICAgICAgIChwcmVzc2VkRHVwbGljYXRlKT1cIm9uTWVudSgnRFVQTElDQVRFJylcIlxuICAgICAgICAgIChwcmVzc2VkU2V0dGluZ3MpPVwib25NZW51KCdTRVRUSU5HUycpXCJcbiAgICAgICAgICAocHJlc3NlZERlbGV0ZSk9XCJvbk1lbnUoJ0RFTEVURScpXCJcbiAgICAgICAgPlxuICAgICAgICA8L3NlbS1zZXR0aW5ncz5cbjwvZGl2PlxuXG5gLFxuICBzdHlsZXM6IFtgOmhvc3QoKXtkaXNwbGF5OmJsb2NrO2JvcmRlcjoxcHggc29saWQgIzhiMDAwMH0uaW1nLWNyb3BwZXJ7aGVpZ2h0OjEwMCV9YF1cbn0pXG5leHBvcnQgY2xhc3MgU2VtTWVkaWFTZXR0aW5nc0NvbnRhaW5lckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIHB1YmxpYyB3aWRnZXQgPSB7XG4gICAgY29tcG9uZW50TmFtZTogJycsXG4gICAgZGF0YTogIGBcbiAgICBMb3JlbSBJcHN1bSBoYXMgYmVlbiB0aGUgaW5kdXN0cnkncyBzdGFuZGFyZCBkdW1teSB0ZXh0IGV2ZXIgc2luY2UgdGhlIDE1MDBzLCB3aGVuIGFuIHVua25vd24gcHJpbnRlciBvb2sgYSBnYWxsZXkgb2YgdHlwZVxuICAgIGFuZCBzY3JhbWJsZWQgaXQgdG8gbWFrZSBhIHR5cGUgc3BlY2ltZW4gYm9vay4gSXQgaGFzIHN1cnZpdmVkIG5vdCBvbmx5IGZpdmUgY2UgbnR1cmllcywgYnV0IGFsc28gdGhlIGxlYXAgaW50byBlbGVjdHJvbmljXG4gICAgdHlwZXNldHRpbmcsIHJlbWFpbmluZyBlc3NlbnRpYWxseSB1bmNoYW5nZWQuIEl0IHdhcyBwb3B1IGxhcmlzZWQgaW4gdGhlIDE5NjBzIHdpdGggdGhlIHJlbGVhc2Ugb2YgTGV0cmFzZXQgc2hlZXRzXG4gICAgY29udGFpbmluZ2BcbiAgfTtcblxuXG4gIHVzZXJJbWFnZXM/OiBBcnJheTxhbnk+ID0gW107XG4gIGVkaXRWaXNpYmxlOiBCb29sZWFuID0gZmFsc2U7XG4gIGtleTogTnVtYmVyO1xuICB1cGxvYWRQYW5lbEZsYWc6IEJvb2xlYW4gPSB0cnVlO1xuICBpbWFnZU5hbWVMaXN0OiBBcnJheTxzdHJpbmc+ID0gW107XG4gIGNvbmZpZzogYW55O1xuICB0ZW1wSW1hZ2VzOiBBcnJheTxhbnk+O1xuICBpc1Rlc3RBT3BlbmVkID0gZmFsc2U7XG5cblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9tZWRpYVNlcnZpY2U6IFNlbU1lZGlhU2VydmljZSwgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IpIHtcbiAgICAvLyB0aGlzLndpZGdldCA9IHRoaXMuaW5qZWN0b3IuZ2V0KCd3aWRnZXQnKTtcbiAgICAvLyBpZih0aGlzLndpZGdldC5jb21wb25lbnROYW1lID09PSAnU2VtTWVkaWFDb250YWluZXJDb21wb25lbnQnKSB7XG4gICAgLy8gICBjb25zb2xlLmxvZygnR290IHRoZSB3eXNpd3lnIGRhdGEnLCB0aGlzLndpZGdldCk7XG4gICAgLy8gfVxuXG4gICAgdGhpcy5fbWVkaWFTZXJ2aWNlLmltYWdlQ29tcG9uZW50Q2hhbmdlcy5zdWJzY3JpYmUoYWxsSW1hZ2VzID0+IHtcbiAgICAgIGxldCBlZGl0TW9kZSA9IGZhbHNlO1xuICAgICAgdGhpcy5pbWFnZU5hbWVMaXN0ID0gW107XG4gICAgICB0aGlzLnVzZXJJbWFnZXMgPSBhbGxJbWFnZXM7XG4gICAgICBmb3IgKGNvbnN0IGltYWdlIG9mIGFsbEltYWdlcykge1xuICAgICAgICBlZGl0TW9kZSA9IGVkaXRNb2RlIHx8IGltYWdlLmVkaXRNb2RlO1xuICAgICAgICB0aGlzLmltYWdlTmFtZUxpc3QucHVzaChpbWFnZS5maWxlTmFtZSk7XG4gICAgICB9XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy5lZGl0VmlzaWJsZSA9IGVkaXRNb2RlO1xuICAgICAgfSk7XG4gICAgfSk7XG4gICAgdGhpcy5fbWVkaWFTZXJ2aWNlLmltYWdlQ29uZmlnQ2hhbmdlcy5zdWJzY3JpYmUoY29uZmlnID0+IHtcbiAgICAgIHRoaXMuY29uZmlnID0gXy5jbG9uZURlZXAoY29uZmlnKTtcbiAgICB9KTtcbiAgICB0aGlzLl9tZWRpYVNlcnZpY2UuaW1hZ2VMb2FkQ2hhbmdlcy5zdWJzY3JpYmUoYWxsSW1hZ2VzID0+IHtcbiAgICAgIHRoaXMudGVtcEltYWdlcyA9IGFsbEltYWdlcztcbiAgICAgIHRoaXMuaW1hZ2VOYW1lTGlzdCA9IFtdO1xuICAgICAgdGhpcy51c2VySW1hZ2VzID0gYWxsSW1hZ2VzO1xuICAgICAgZm9yIChjb25zdCBpbWFnZSBvZiBhbGxJbWFnZXMpIHtcbiAgICAgICAgdGhpcy5pbWFnZU5hbWVMaXN0LnB1c2goaW1hZ2UuZmlsZU5hbWUpO1xuICAgICAgfVxuICAgICAgdGhpcy5rZXkgPSBhbGxJbWFnZXMubGVuZ3RoIC0gMTtcbiAgICAgIHRoaXMuZWRpdFZpc2libGUgPSBmYWxzZTtcbiAgICAgIGlmIChhbGxJbWFnZXMubGVuZ3RoID4gMSkge1xuICAgICAgICB0aGlzLnVwbG9hZFBhbmVsRmxhZyA9IGZhbHNlO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMuX21lZGlhU2VydmljZS50ZW1wQ2hhbmdlcy5zdWJzY3JpYmUoYWxsSW1hZ2VzID0+IHtcbiAgICAgIHRoaXMudGVtcEltYWdlcyA9IGFsbEltYWdlcztcbiAgICB9KTtcbiAgfVxuICBuZ09uSW5pdCgpIHtcbiAgfVxuICB1cGxvYWRlZEltYWdlKGltYWdlOiBGaWxlKSB7XG4gICAgdGhpcy5fbWVkaWFTZXJ2aWNlLnB1dEltYWdlKGltYWdlKTtcbiAgfVxuICBvbkVuYWJsZUVkaXRJbWFnZShpbmRleCkge1xuICAgIHRoaXMuX21lZGlhU2VydmljZS5vbkVkaXRFbmFibGUoaW5kZXgpO1xuICAgIHRoaXMudXBsb2FkUGFuZWxGbGFnID0gdHJ1ZTtcbiAgICB0aGlzLmtleSA9IGluZGV4O1xuICB9XG4gIG9uRWRpdEltYWdlKGluZGV4KSB7XG4gICAgdGhpcy5rZXkgPSBpbmRleDtcbiAgICB0aGlzLl9tZWRpYVNlcnZpY2Uub25FZGl0RW5hYmxlKGluZGV4KTtcbiAgfVxuICBvbkRlbGV0ZUltYWdlKGluZGV4KSB7XG4gICAgdGhpcy5fbWVkaWFTZXJ2aWNlLm9uRGVsZXRlSW1hZ2UoaW5kZXgpO1xuICB9XG4gIG9uTWVudShtb2RlKSB7XG4gICAgc3dpdGNoIChtb2RlKSB7XG4gICAgICBjYXNlICdJTUFHRVMnOlxuICAgICAgICB0aGlzLnVwbG9hZFBhbmVsRmxhZyA9IHRydWU7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnRFVQTElDQVRFJzpcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdTRVRUSU5HUyc6XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnREVMRVRFJzpcbiAgICAgICAgdGhpcy5fbWVkaWFTZXJ2aWNlLmNsZWFySW1hZ2VzKCk7XG4gICAgICAgIHRoaXMuaW1hZ2VOYW1lTGlzdCA9IFtdO1xuICAgICAgICB0aGlzLnVwbG9hZFBhbmVsRmxhZyA9IHRydWU7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICBvbkNoYW5nZWRGb3JtKGZvcm1EYXRhOiBhbnkpIHtcbiAgICB0aGlzLl9tZWRpYVNlcnZpY2UuZm9ybUNoYW5nZWQodGhpcy5rZXksIGZvcm1EYXRhKTtcbiAgfVxuICBvbkNoYW5nZWRFZGl0TW9kZShtb2RlOiBzdHJpbmcpIHtcbiAgICBpZiAobW9kZSA9PT0gJ0FQUExZJykge1xuICAgICAgLy8gdGhpcy5lZGl0VmlzaWJsZSA9IGZhbHNlO1xuICAgICAgaWYgKHRoaXMuaW1hZ2VOYW1lTGlzdC5sZW5ndGggPiAxKSB7XG4gICAgICAgIHRoaXMudXBsb2FkUGFuZWxGbGFnID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuX21lZGlhU2VydmljZS5vbkVkaXRJbWFnZSh0aGlzLmtleSwgbW9kZSk7XG4gICAgdGhpcy5fbWVkaWFTZXJ2aWNlLmNsZWFyQ29uZmlnKHRoaXMua2V5KTtcbiAgfVxuICBvbkNyb3BwZWRJbWFnZShpbmRleCwgY3JvcHBlZEltYWdlKSB7XG4gICAgdGhpcy5fbWVkaWFTZXJ2aWNlLnB1dENyb3BwZWRJbWFnZShpbmRleCwgY3JvcHBlZEltYWdlKTtcbiAgfVxuICBvcGVuVGVzdEEoaXNPcGVuZWQ6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmlzVGVzdEFPcGVuZWQgPSBpc09wZW5lZDtcbiAgfVxuXG5cblxuICBjcm9wcGVkSW1hZ2UoaXRlbSl7XG4gICAgY29uc29sZS5sb2coJ25vdCBzdXJlJywgaXRlbSlcbiAgfVxufVxuIl19